---
id: configuration
title: پیکربندی
---

این صفحه تمام گزینه‌های پیکربندی برای سرور MCP WebdriverIO را مستند می‌کند.

## پیکربندی سرور MCP

سرور MCP از طریق فایل‌های پیکربندی Claude Desktop یا Claude Code تنظیم می‌شود.

### پیکربندی اولیه

#### macOS

ویرایش `~/Library/Application Support/Claude/claude_desktop_config.json`:

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"]
        }
    }
}
```

#### Windows

ویرایش `%APPDATA%\Claude\claude_desktop_config.json`:

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"]
        }
    }
}
```

#### Claude Code

ویرایش `.claude/settings.json` در پروژه خود:

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"]
        }
    }
}
```

---

## متغیرهای محیطی

اتصال سرور Appium و سایر تنظیمات را از طریق متغیرهای محیطی پیکربندی کنید.

### اتصال Appium

| متغیر | نوع | پیش‌فرض | توضیحات |
|----------|------|---------|-------------|
| `APPIUM_URL` | string | `127.0.0.1` | نام میزبان سرور Appium |
| `APPIUM_URL_PORT` | number | `4723` | پورت سرور Appium |
| `APPIUM_PATH` | string | `/` | مسیر سرور Appium |

### مثال با متغیرهای محیطی

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"],
            "env": {
                "APPIUM_URL": "192.168.1.100",
                "APPIUM_URL_PORT": "4724",
                "APPIUM_PATH": "/wd/hub"
            }
        }
    }
}
```

---

## گزینه‌های نشست مرورگر

گزینه‌های موجود هنگام شروع نشست مرورگر از طریق ابزار `start_browser`.

### `headless`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `false`

اجرای Chrome در حالت بدون نمایش (بدون پنجره مرورگر قابل مشاهده). مناسب برای محیط‌های CI/CD یا زمانی که نیازی به دیدن مرورگر ندارید.

### `windowWidth`

-   **نوع:** `number`
-   **اجباری:** خیر
-   **پیش‌فرض:** `1920`
-   **محدوده:** `400` - `3840`

عرض اولیه پنجره مرورگر بر حسب پیکسل.

### `windowHeight`

-   **نوع:** `number`
-   **اجباری:** خیر
-   **پیش‌فرض:** `1080`
-   **محدوده:** `400` - `2160`

ارتفاع اولیه پنجره مرورگر بر حسب پیکسل.

### `navigationUrl`

-   **نوع:** `string`
-   **اجباری:** خیر

URL برای ناوبری بلافاصله پس از شروع مرورگر. این روش کارآمدتر از فراخوانی جداگانه `start_browser` و سپس `navigate` است.

**مثال:** شروع مرورگر و ناوبری در یک فراخوانی:
```
Start Chrome and navigate to https://webdriver.io
```

---

## گزینه‌های نشست موبایل

گزینه‌های موجود هنگام شروع نشست برنامه موبایل از طریق ابزار `start_app_session`.

### گزینه‌های پلتفرم

#### `platform`

-   **نوع:** `string`
-   **اجباری:** بله
-   **مقادیر:** `iOS` | `Android`

پلتفرم موبایل برای اتوماسیون.

#### `platformVersion`

-   **نوع:** `string`
-   **اجباری:** خیر

نسخه سیستم عامل دستگاه/شبیه‌ساز/امولاتور (مانند `17.0` برای iOS، `14` برای Android).

#### `automationName`

-   **نوع:** `string`
-   **اجباری:** خیر
-   **مقادیر:** `XCUITest` (iOS)، `UiAutomator2` | `Espresso` (Android)

درایور اتوماسیون مورد استفاده. پیش‌فرض `XCUITest` برای iOS و `UiAutomator2` برای Android است.

### گزینه‌های دستگاه

#### `deviceName`

-   **نوع:** `string`
-   **اجباری:** بله

نام دستگاه، شبیه‌ساز یا امولاتور مورد استفاده.

**مثال‌ها:**
-   شبیه‌ساز iOS: `iPhone 15 Pro`، `iPad Air (5th generation)`
-   امولاتور Android: `Pixel 7`، `Nexus 5X`
-   دستگاه واقعی: نام دستگاه همانطور که در سیستم شما نمایش داده می‌شود

#### `udid`

-   **نوع:** `string`
-   **اجباری:** خیر (برای دستگاه‌های واقعی iOS الزامی است)

شناسه منحصر به فرد دستگاه. برای دستگاه‌های واقعی iOS (شناسه ۴۰ کاراکتری) الزامی است و برای دستگاه‌های واقعی Android توصیه می‌شود.

**یافتن UDID:**
-   **iOS:** دستگاه را متصل کنید، Finder/iTunes را باز کنید، روی دستگاه کلیک کنید → شماره سریال (برای نمایش UDID کلیک کنید)
-   **Android:** دستور `adb devices` را در ترمینال اجرا کنید

### گزینه‌های برنامه

#### `appPath`

-   **نوع:** `string`
-   **اجباری:** خیر*

مسیر فایل برنامه برای نصب و اجرا.

**فرمت‌های پشتیبانی شده:**
-   شبیه‌ساز iOS: دایرکتوری `.app`
-   دستگاه واقعی iOS: فایل `.ipa`
-   Android: فایل `.apk`

*یا باید `appPath` ارائه شود، یا `noReset: true` برای اتصال به برنامه‌ای که از قبل در حال اجرا است.

#### `appWaitActivity`

-   **نوع:** `string`
-   **اجباری:** خیر (فقط Android)

فعالیتی که هنگام راه‌اندازی برنامه منتظر آن باشد. اگر مشخص نشود، از فعالیت اصلی/لانچر برنامه استفاده می‌شود.

**مثال:** `com.example.app.MainActivity`

### گزینه‌های وضعیت نشست

#### `noReset`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `false`

حفظ وضعیت برنامه بین نشست‌ها. وقتی `true` است:
-   داده‌های برنامه حفظ می‌شود (وضعیت ورود، تنظیمات و غیره)
-   نشست **جدا** می‌شود به جای بسته شدن (برنامه در حال اجرا می‌ماند)
-   برای آزمایش مسیرهای کاربری در چندین نشست مفید است
-   می‌تواند بدون `appPath` برای اتصال به برنامه‌ای که از قبل در حال اجرا است استفاده شود

#### `fullReset`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `true`

بازنشانی کامل برنامه قبل از نشست. وقتی `true` است:
-   iOS: برنامه را حذف و مجدداً نصب می‌کند
-   Android: داده‌ها و کش برنامه را پاک می‌کند
-   برای شروع با حالت تمیز مفید است

برای حفظ کامل وضعیت برنامه، `fullReset: false` را با `noReset: true` تنظیم کنید.

### زمان انتظار نشست

#### `newCommandTimeout`

-   **نوع:** `number`
-   **اجباری:** خیر
-   **پیش‌فرض:** `60`

مدت زمانی (به ثانیه) که Appium منتظر فرمان جدیدی می‌ماند قبل از اینکه فرض کند کلاینت خارج شده و نشست را پایان دهد. این مقدار را برای نشست‌های اشکال‌زدایی طولانی‌تر افزایش دهید.

**مثال‌ها:**
-   `60` - پیش‌فرض، مناسب برای اکثر اتوماسیون‌ها
-   `300` - ۵ دقیقه، برای اشکال‌زدایی یا عملیات‌های کندتر
-   `600` - ۱۰ دقیقه، برای تست‌های بسیار طولانی

### گزینه‌های مدیریت خودکار

#### `autoGrantPermissions`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `true`

اعطای خودکار مجوزهای برنامه در زمان نصب/راه‌اندازی. وقتی `true` است:
-   مجوزهای دوربین، میکروفون، موقعیت مکانی و غیره به صورت خودکار اعطا می‌شوند
-   نیازی به مدیریت دستی دیالوگ‌های مجوز نیست
-   با اجتناب از پنجره‌های بازشونده مجوز، اتوماسیون را ساده‌تر می‌کند

:::note فقط Android
این گزینه عمدتاً بر Android تأثیر می‌گذارد. مجوزهای iOS به دلیل محدودیت‌های سیستمی باید به روش دیگری مدیریت شوند.
:::

#### `autoAcceptAlerts`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `true`

پذیرش خودکار هشدارهای سیستم (دیالوگ‌ها) که در طول اتوماسیون ظاهر می‌شوند.

**مثال‌هایی از هشدارهایی که به طور خودکار پذیرفته می‌شوند:**
-   "اجازه اعلان‌ها؟"
-   "برنامه می‌خواهد به موقعیت مکانی شما دسترسی داشته باشد"
-   "به برنامه اجازه دسترسی به عکس‌ها داده شود؟"

#### `autoDismissAlerts`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `false`

رد کردن (لغو) هشدارهای سیستم به جای پذیرفتن آنها. زمانی که به `true` تنظیم شود، بر `autoAcceptAlerts` اولویت دارد.

### جایگزینی سرور Appium

می‌توانید اتصال سرور Appium را برای هر نشست به صورت جداگانه جایگزین کنید:

#### `appiumHost`

-   **نوع:** `string`
-   **اجباری:** خیر

نام میزبان سرور Appium. متغیر محیطی `APPIUM_URL` را جایگزین می‌کند.

#### `appiumPort`

-   **نوع:** `number`
-   **اجباری:** خیر

پورت سرور Appium. متغیر محیطی `APPIUM_URL_PORT` را جایگزین می‌کند.

#### `appiumPath`

-   **نوع:** `string`
-   **اجباری:** خیر

مسیر سرور Appium. متغیر محیطی `APPIUM_PATH` را جایگزین می‌کند.

---

## گزینه‌های تشخیص عنصر

گزینه‌ها برای ابزار `get_visible_elements`.

### `elementType`

-   **نوع:** `string`
-   **اجباری:** خیر
-   **پیش‌فرض:** `interactable`
-   **مقادیر:** `interactable` | `visual` | `all`

نوع عناصری که باید برگردانده شوند:
-   `interactable`: دکمه‌ها، لینک‌ها، ورودی‌ها و سایر عناصر قابل کلیک
-   `visual`: تصاویر، SVG‌ها و عناصر بصری
-   `all`: هر دو نوع عناصر interactable و visual

### `inViewportOnly`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `true`

فقط عناصری که در viewport فعلی قابل مشاهده هستند را برمی‌گرداند. وقتی `false` است، تمام عناصر در سلسله مراتب نما را برمی‌گرداند (برای یافتن عناصر خارج از صفحه مفید است).

### `includeContainers`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `false`

عناصر کانتینر/لایه‌بندی را در نتایج شامل می‌کند. وقتی `true` است:

**کانتینرهای Android شامل:**
-   `ViewGroup`، `FrameLayout`، `LinearLayout`
-   `RelativeLayout`، `ConstraintLayout`
-   `ScrollView`، `RecyclerView`

**کانتینرهای iOS شامل:**
-   `View`، `StackView`، `CollectionView`
-   `ScrollView`، `TableView`

برای اشکال‌زدایی مشکلات لایه‌بندی یا درک سلسله مراتب نما مفید است.

### `includeBounds`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `false`

مرزها/مختصات عنصر (x، y، عرض، ارتفاع) را در پاسخ شامل می‌کند. برای موارد زیر `true` تنظیم کنید:
-   تعاملات مبتنی بر مختصات
-   اشکال‌زدایی لایه‌بندی
-   موقعیت‌یابی عناصر بصری

### گزینه‌های صفحه‌بندی

برای صفحات بزرگ با عناصر زیاد، از صفحه‌بندی برای کاهش مصرف توکن استفاده کنید:

#### `limit`

-   **نوع:** `number`
-   **اجباری:** خیر
-   **پیش‌فرض:** `0` (نامحدود)

حداکثر تعداد عناصر برای برگرداندن.

#### `offset`

-   **نوع:** `number`
-   **اجباری:** خیر
-   **پیش‌فرض:** `0`

تعداد عناصری که قبل از برگرداندن نتایج باید رد شوند.

**مثال:** دریافت عناصر 21-40:
```
Get visible elements with limit 20 and offset 20
```

---

## گزینه‌های درخت دسترسی‌پذیری

گزینه‌ها برای ابزار `get_accessibility` (فقط مرورگر).

### `limit`

-   **نوع:** `number`
-   **اجباری:** خیر
-   **پیش‌فرض:** `100`

حداکثر تعداد گره‌ها برای برگرداندن. از `0` برای نامحدود استفاده کنید (برای صفحات بزرگ توصیه نمی‌شود).

### `offset`

-   **نوع:** `number`
-   **اجباری:** خیر
-   **پیش‌فرض:** `0`

تعداد گره‌ها برای رد کردن جهت صفحه‌بندی.

### `roles`

-   **نوع:** `string[]`
-   **اجباری:** خیر
-   **پیش‌فرض:** تمام نقش‌ها

فیلتر کردن به نقش‌های دسترسی‌پذیری خاص.

**نقش‌های متداول:** `button`، `link`، `textbox`، `checkbox`، `radio`، `heading`، `img`، `listitem`

**مثال:** فقط دکمه‌ها و لینک‌ها را دریافت کنید:
```
Get accessibility tree filtered to button and link roles
```

### `namedOnly`

-   **نوع:** `boolean`
-   **اجباری:** خیر
-   **پیش‌فرض:** `true`

فقط گره‌هایی که دارای نام/برچسب هستند را برمی‌گرداند. کانتینرهای بی‌نام را فیلتر می‌کند و نویز را در نتایج کاهش می‌دهد.

---

## گزینه‌های عکس‌برداری از صفحه

گزینه‌ها برای ابزار `take_screenshot`.

### `outputPath`

-   **نوع:** `string`
-   **اجباری:** خیر

مسیری که فایل عکس‌برداری از صفحه باید در آن ذخیره شود. اگر ارائه نشود، داده‌های تصویر با کدگذاری base64 را برمی‌گرداند.

### بهینه‌سازی خودکار

عکس‌های صفحه به طور خودکار برای بهینه‌سازی مصرف LLM پردازش می‌شوند:

| بهینه‌سازی | مقدار | توضیحات |
|--------------|-------|-------------|
| حداکثر ابعاد | 2000px | تصاویر بزرگتر از 2000px کوچک می‌شوند |
| حداکثر اندازه فایل | 1MB | تصاویر فشرده می‌شوند تا زیر 1MB باقی بمانند |
| فرمت | PNG/JPEG | PNG با حداکثر فشرده‌سازی؛ JPEG در صورت نیاز برای اندازه |

این بهینه‌سازی اطمینان می‌دهد که عکس‌های صفحه می‌توانند بدون تجاوز از محدودیت‌های توکن، به طور کارآمد پردازش شوند.

---

## رفتار نشست

### انواع نشست

سرور MCP انواع نشست را برای ارائه ابزارها و رفتار مناسب پیگیری می‌کند:

| نوع | توضیحات | جداسازی خودکار |
|------|-------------|-------------|
| `browser` | نشست مرورگر Chrome | خیر |
| `ios` | نشست برنامه iOS | بله (اگر `noReset: true` یا بدون `appPath` باشد) |
| `android` | نشست برنامه Android | بله (اگر `noReset: true` یا بدون `appPath` باشد) |

### مدل تک‌نشستی

سرور MCP با **مدل تک‌نشستی** کار می‌کند:

-   فقط یک نشست مرورگر یا برنامه می‌تواند در یک زمان فعال باشد
-   شروع یک نشست جدید، نشست فعلی را می‌بندد/جدا می‌کند
-   وضعیت نشست به صورت سراسری در تمام فراخوانی‌های ابزار حفظ می‌شود

### جداسازی در مقابل بستن

| عمل | `detach: false` (بستن) | `detach: true` (جداسازی) |
|--------|-------------------------|-------------------------|
| مرورگر | Chrome را کاملاً می‌بندد | Chrome را در حال اجرا نگه می‌دارد، WebDriver را قطع می‌کند |
| برنامه موبایل | برنامه را متوقف می‌کند | برنامه را در وضعیت فعلی در حال اجرا نگه می‌دارد |
| مورد استفاده | وضعیت تازه برای نشست بعدی | حفظ وضعیت، بررسی دستی |

---

## ملاحظات عملکرد

سرور MCP برای ارتباط کارآمد LLM با استفاده از فرمت **TOON (Token-Oriented Object Notation)** بهینه‌سازی شده است که استفاده از توکن را هنگام ارسال داده به Claude به حداقل می‌رساند.

### اتوماسیون مرورگر

-   **حالت بدون نمایش (Headless)** سریع‌تر است اما عناصر بصری را رندر نمی‌کند
-   **اندازه‌های کوچکتر پنجره** زمان گرفتن عکس از صفحه را کاهش می‌دهد
-   **تشخیص عنصر** با اجرای یک اسکریپت واحد بهینه‌سازی شده است
-   **بهینه‌سازی عکس از صفحه** تصاویر را زیر 1MB نگه می‌دارد تا پردازش کارآمد باشد
-   **`inViewportOnly: true`** (پیش‌فرض) فقط به عناصر قابل مشاهده فیلتر می‌کند

### اتوماسیون موبایل

-   **تجزیه منبع صفحه XML** فقط از 2 فراخوانی HTTP استفاده می‌کند (در مقابل 600+ برای پرس و جوهای عنصر سنتی)
-   **انتخاب‌کننده‌های شناسه دسترسی‌پذیری** سریع‌ترین و قابل اعتمادترین هستند
-   **انتخاب‌کننده‌های XPath** کندترین هستند - فقط به عنوان آخرین چاره استفاده کنید
-   **`inViewportOnly: true`** (پیش‌فرض) تعداد عناصر را به طور قابل توجهی کاهش می‌دهد
-   **صفحه‌بندی** (`limit` و `offset`) مصرف توکن را برای صفحه‌هایی با تعداد زیادی عنصر کاهش می‌دهد
-   **`includeBounds: false`** (پیش‌فرض) داده‌های مختصات را حذف می‌کند مگر اینکه لازم باشد

### نکات استفاده از توکن

| تنظیم | تأثیر |
|---------|--------|
| `inViewportOnly: true` | عناصر خارج از صفحه را فیلتر می‌کند و اندازه پاسخ را کاهش می‌دهد |
| `includeContainers: false` | عناصر لایه‌بندی (ViewGroup و غیره) را حذف می‌کند |
| `includeBounds: false` | داده‌های x/y/width/height را حذف می‌کند |
| `limit` با صفحه‌بندی | پردازش عناصر به صورت دسته‌ای به جای همه یکجا |
| `namedOnly: true` (دسترسی‌پذیری) | گره‌های بی‌نام را فیلتر می‌کند |

---

## راه‌اندازی سرور Appium

قبل از استفاده از اتوماسیون موبایل، اطمینان حاصل کنید که Appium به درستی پیکربندی شده است.

### راه‌اندازی اولیه

```sh
# نصب Appium به صورت سراسری
npm install -g appium

# نصب درایورها
appium driver install xcuitest    # iOS
appium driver install uiautomator2  # Android

# راه‌اندازی سرور
appium
```

### پیکربندی سرور سفارشی

```sh
# راه‌اندازی با میزبان و پورت سفارشی
appium --address 0.0.0.0 --port 4724

# راه‌اندازی با لاگ‌گذاری
appium --log-level debug

# راه‌اندازی با مسیر پایه خاص
appium --base-path /wd/hub
```

### تأیید نصب

```sh
# بررسی درایورهای نصب شده
appium driver list --installed

# بررسی نسخه Appium
appium --version

# تست اتصال
curl http://localhost:4723/status
```

---

## عیب‌یابی پیکربندی

### سرور MCP راه‌اندازی نمی‌شود

1. تأیید کنید که npm/npx نصب شده است: `npm --version`
2. سعی کنید به صورت دستی اجرا کنید: `npx @wdio/mcp`
3. لاگ‌های Claude Desktop را برای خطاها بررسی کنید

### مشکلات اتصال Appium

1. تأیید کنید که Appium در حال اجرا است: `curl http://localhost:4723/status`
2. بررسی کنید که متغیرهای محیطی با تنظیمات سرور Appium مطابقت دارند
3. اطمینان حاصل کنید که فایروال اجازه اتصال در پورت Appium را می‌دهد

### نشست شروع نمی‌شود

1. **مرورگر:** اطمینان حاصل کنید که Chrome نصب شده است
2. **iOS:** تأیید کنید که Xcode و شبیه‌سازها در دسترس هستند
3. **Android:** `ANDROID_HOME` را بررسی کنید و امولاتور در حال اجرا باشد
4. لاگ‌های سرور Appium را برای پیام‌های خطای دقیق بررسی کنید

### زمان انتظار نشست تمام می‌شود

اگر نشست‌ها در حین اشکال‌زدایی به پایان می‌رسند:
1. `newCommandTimeout` را هنگام شروع نشست افزایش دهید
2. از `noReset: true` برای حفظ وضعیت بین نشست‌ها استفاده کنید
3. هنگام بستن از `detach: true` استفاده کنید تا برنامه در حال اجرا باقی بماند