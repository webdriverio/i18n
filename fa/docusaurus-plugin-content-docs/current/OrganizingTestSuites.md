---
id: organizingsuites
title: سازماندهی مجموعه آزمون
---

با رشد پروژه‌ها، ناگزیر آزمون‌های یکپارچه بیشتر و بیشتری اضافه می‌شوند. این باعث افزایش زمان ساخت و کاهش بهره‌وری می‌شود.

برای جلوگیری از این مشکل، باید آزمون‌های خود را به صورت موازی اجرا کنید. WebdriverIO هر مشخصه (یا _فایل ویژگی_ در Cucumber) را به صورت موازی در یک جلسه واحد آزمایش می‌کند. به طور کلی، سعی کنید فقط یک ویژگی را در هر فایل مشخصات آزمایش کنید. سعی کنید تعداد آزمون‌های بسیار زیاد یا بسیار کم در یک فایل نداشته باشید. (البته، هیچ قانون طلایی در اینجا وجود ندارد.)

هنگامی که آزمون‌های شما چندین فایل مشخصات دارند، باید اجرای آزمون‌ها را به صورت همزمان شروع کنید. برای این کار، خاصیت `maxInstances` را در فایل پیکربندی خود تنظیم کنید. WebdriverIO به شما اجازه می‌دهد آزمون‌های خود را با حداکثر همزمانی اجرا کنید، به این معنی که مهم نیست چند فایل و آزمون دارید، همه می‌توانند به صورت موازی اجرا شوند. (این همچنان تابع محدودیت‌های خاصی مانند CPU کامپیوتر شما، محدودیت‌های همزمانی و غیره است.)

> فرض کنید ۳ قابلیت مختلف (Chrome، Firefox و Safari) دارید و `maxInstances` را روی `1` تنظیم کرده‌اید. اجراکننده آزمون WDIO ۳ فرآیند ایجاد خواهد کرد. بنابراین، اگر ۱۰ فایل مشخصات داشته باشید و `maxInstances` را روی `10` تنظیم کنید، _همه_ فایل‌های مشخصات به طور همزمان آزمایش می‌شوند و ۳۰ فرآیند راه‌اندازی می‌شود.

می‌توانید خاصیت `maxInstances` را به صورت سراسری تعریف کنید تا ویژگی را برای تمام مرورگرها تنظیم کنید.

اگر شبکه WebDriver خود را اجرا می‌کنید، ممکن است (به عنوان مثال) برای یک مرورگر نسبت به مرورگر دیگر ظرفیت بیشتری داشته باشید. در این صورت، می‌توانید `maxInstances` را در شی قابلیت خود _محدود_ کنید:

```js
// wdio.conf.js
export const config = {
    // ...
    // set maxInstance for all browser
    maxInstances: 10,
    // ...
    capabilities: [{
        browserName: 'firefox'
    }, {
        // maxInstances can get overwritten per capability. So if you have an in-house WebDriver
        // grid with only 5 firefox instance available you can make sure that not more than
        // 5 instance gets started at a time.
        browserName: 'chrome'
    }],
    // ...
}
```

## ارث بری از فایل پیکربندی اصلی

اگر مجموعه آزمون خود را در محیط‌های مختلف (مانند توسعه و یکپارچه‌سازی) اجرا می‌کنید، استفاده از چندین فایل پیکربندی می‌تواند برای مدیریت بهتر امور کمک کند.

مشابه [مفهوم شی صفحه](pageobjects)، اولین چیزی که نیاز دارید یک فایل پیکربندی اصلی است. این فایل حاوی تمام پیکربندی‌هایی است که در محیط‌های مختلف به اشتراک می‌گذارید.

سپس برای هر محیط یک فایل پیکربندی دیگر ایجاد کنید و پیکربندی اصلی را با پیکربندی‌های مخصوص محیط تکمیل کنید:

```js
// wdio.dev.config.js
import { deepmerge } from 'deepmerge-ts'
import wdioConf from './wdio.conf.js'

// have main config file as default but overwrite environment specific information
export const config = deepmerge(wdioConf.config, {
    capabilities: [
        // more caps defined here
        // ...
    ],

    // run tests on sauce instead locally
    user: process.env.SAUCE_USERNAME,
    key: process.env.SAUCE_ACCESS_KEY,
    services: ['sauce']
}, { clone: false })

// add an additional reporter
config.reporters.push('allure')
```

## گروه‌بندی مشخصات آزمون در مجموعه‌ها

می‌توانید مشخصات آزمون را در مجموعه‌ها گروه‌بندی کنید و به جای همه آنها، فقط مجموعه‌های خاصی را اجرا کنید.

ابتدا، مجموعه‌های خود را در پیکربندی WDIO تعریف کنید:

```js
// wdio.conf.js
export const config = {
    // define all tests
    specs: ['./test/specs/**/*.spec.js'],
    // ...
    // define specific suites
    suites: {
        login: [
            './test/specs/login.success.spec.js',
            './test/specs/login.failure.spec.js'
        ],
        otherFeature: [
            // ...
        ]
    },
    // ...
}
```

حالا، اگر می‌خواهید فقط یک مجموعه را اجرا کنید، می‌توانید نام مجموعه را به عنوان آرگومان CLI ارسال کنید:

```sh
wdio wdio.conf.js --suite login
```

یا، اجرای چند مجموعه به طور همزمان:

```sh
wdio wdio.conf.js --suite login --suite otherFeature
```

## گروه‌بندی مشخصات آزمون برای اجرای متوالی

همانطور که در بالا توضیح داده شد، اجرای همزمان آزمون‌ها مزایایی دارد. با این حال، مواردی وجود دارد که گروه‌بندی آزمون‌ها برای اجرای متوالی در یک نمونه واحد مفید خواهد بود. نمونه‌های این موارد عمدتاً جایی است که هزینه راه‌اندازی بزرگی وجود دارد مانند ترجمه کد یا تهیه نمونه‌های ابری، اما مدل‌های استفاده پیشرفته‌ای نیز وجود دارند که از این قابلیت بهره می‌برند.

برای گروه‌بندی آزمون‌ها برای اجرا در یک نمونه واحد، آنها را به عنوان یک آرایه در تعریف مشخصات تعریف کنید.

```json
    "specs": [
        [
            "./test/specs/test_login.js",
            "./test/specs/test_product_order.js",
            "./test/specs/test_checkout.js"
        ],
        "./test/specs/test_b*.js",
    ],
```
در مثال بالا، آزمون‌های 'test_login.js'، 'test_product_order.js' و 'test_checkout.js' به صورت متوالی در یک نمونه واحد اجرا می‌شوند و هر یک از آزمون‌های "test_b*" به طور همزمان در نمونه‌های فردی اجرا می‌شوند.

همچنین می‌توان مشخصات تعریف شده در مجموعه‌ها را گروه‌بندی کرد، بنابراین اکنون می‌توانید مجموعه‌ها را به این صورت نیز تعریف کنید:
```json
    "suites": {
        end2end: [
            [
                "./test/specs/test_login.js",
                "./test/specs/test_product_order.js",
                "./test/specs/test_checkout.js"
            ]
        ],
        allb: ["./test/specs/test_b*.js"]
},
```
و در این حالت تمام آزمون‌های مجموعه "end2end" در یک نمونه واحد اجرا می‌شوند.

هنگام اجرای آزمون‌ها به صورت متوالی با استفاده از یک الگو، فایل‌های مشخصات را به ترتیب الفبایی اجرا می‌کند

```json
  "suites": {
    end2end: ["./test/specs/test_*.js"]
  },
```

این فایل‌های مطابق با الگوی بالا را به ترتیب زیر اجرا می‌کند:

```
  [
      "./test/specs/test_checkout.js",
      "./test/specs/test_login.js",
      "./test/specs/test_product_order.js"
  ]
```

## اجرای آزمون‌های انتخاب شده

در برخی موارد، ممکن است بخواهید فقط یک آزمون (یا زیرمجموعه‌ای از آزمون‌ها) از مجموعه‌های خود را اجرا کنید.

با پارامتر `--spec`، می‌توانید مشخص کنید که کدام _مجموعه_ (Mocha، Jasmine) یا _ویژگی_ (Cucumber) باید اجرا شود. مسیر نسبت به دایرکتوری کاری فعلی شما حل می‌شود.

به عنوان مثال، برای اجرای فقط آزمون ورود به سیستم خود:

```sh
wdio wdio.conf.js --spec ./test/specs/e2e/login.js
```

یا اجرای چندین مشخصه به طور همزمان:

```sh
wdio wdio.conf.js --spec ./test/specs/signup.js --spec ./test/specs/forgot-password.js
```

اگر مقدار `--spec` به یک فایل مشخصات خاص اشاره نکند، به جای آن برای فیلتر کردن نام‌های فایل مشخصات تعریف شده در پیکربندی شما استفاده می‌شود.

برای اجرای تمام مشخصاتی که کلمه "dialog" در نام فایل مشخصات دارند، می‌توانید از موارد زیر استفاده کنید:

```sh
wdio wdio.conf.js --spec dialog
```

توجه داشته باشید که هر فایل آزمون در یک فرآیند اجراکننده آزمون واحد اجرا می‌شود. از آنجا که ما فایل‌ها را از قبل اسکن نمی‌کنیم (برای اطلاعات در مورد انتقال نام‌های فایل به `wdio` به بخش بعدی مراجعه کنید)، شما _نمی‌توانید_ (به عنوان مثال) از `describe.only` در بالای فایل مشخصات خود برای دستور دادن به Mocha برای اجرای فقط آن مجموعه استفاده کنید.

این ویژگی به شما کمک می‌کند تا به همان هدف برسید.

هنگامی که گزینه `--spec` ارائه می‌شود، هر الگوی تعریف شده توسط پارامتر `specs` در سطح پیکربندی یا قابلیت را نادیده می‌گیرد.

## استثنا کردن آزمون‌های انتخاب شده

در صورت نیاز، اگر می‌خواهید فایل(های) مشخصات خاصی را از اجرا حذف کنید، می‌توانید از پارامتر `--exclude` (Mocha، Jasmine) یا ویژگی (Cucumber) استفاده کنید.

به عنوان مثال، برای استثنا کردن آزمون ورود به سیستم خود از اجرای آزمون:

```sh
wdio wdio.conf.js --exclude ./test/specs/e2e/login.js
```

یا، حذف چندین فایل مشخصات:

 ```sh
wdio wdio.conf.js --exclude ./test/specs/signup.js --exclude ./test/specs/forgot-password.js
```

یا، حذف یک فایل مشخصات هنگام فیلتر کردن با استفاده از یک مجموعه:

```sh
wdio wdio.conf.js --suite login --exclude ./test/specs/e2e/login.js
```

اگر مقدار `--exclude` به یک فایل مشخصات خاص اشاره نکند، به جای آن برای فیلتر کردن نام‌های فایل مشخصات تعریف شده در پیکربندی شما استفاده می‌شود.

برای حذف تمام مشخصاتی که کلمه "dialog" در نام فایل مشخصات دارند، می‌توانید از موارد زیر استفاده کنید:

```sh
wdio wdio.conf.js --exclude dialog
```

### حذف کامل یک مجموعه

همچنین می‌توانید یک مجموعه کامل را با نام حذف کنید. اگر مقدار استثنا با نام مجموعه تعریف شده در پیکربندی شما مطابقت داشته باشد و مانند مسیر فایل به نظر نرسد، کل مجموعه رد می‌شود:

```sh
wdio wdio.conf.js --suite login --suite checkout --exclude login
```

این فقط مجموعه `checkout` را اجرا می‌کند و کل مجموعه `login` را رد می‌کند.

استثناهای ترکیبی (مجموعه‌ها و الگوهای مشخصات) طبق انتظار کار می‌کنند:

```sh
wdio wdio.conf.js --suite login --exclude dialog --exclude signup
```

در این مثال، اگر `signup` نام مجموعه تعریف شده باشد، آن مجموعه حذف می‌شود. الگوی `dialog` هر فایل مشخصاتی که حاوی "dialog" در نام فایل خود باشد را فیلتر می‌کند.

:::note
اگر هم `--suite X` و هم `--exclude X` را مشخص کنید، استثنا اولویت دارد و مجموعه `X` اجرا نخواهد شد.
:::

هنگامی که گزینه `--exclude` ارائه می‌شود، هر الگوی تعریف شده توسط پارامتر `exclude` در سطح پیکربندی یا قابلیت را نادیده می‌گیرد.

## اجرای مجموعه‌ها و مشخصات آزمون

اجرای یک مجموعه کامل همراه با مشخصات فردی.

```sh
wdio wdio.conf.js --suite login --spec ./test/specs/signup.js
```

## اجرای چندین مشخصات آزمون خاص

گاهی اوقات در زمینه یکپارچه‌سازی مداوم و غیره، مشخص کردن چندین مجموعه از مشخصات برای اجرا ضروری است. ابزار خط فرمان `wdio` از WebdriverIO نام‌های فایل منتقل شده (از `find`، `grep` یا دیگران) را می‌پذیرد.

نام‌های فایل منتقل شده، لیست الگوها یا نام‌های فایل مشخص شده در لیست `spec` پیکربندی را نادیده می‌گیرند.

```sh
grep -r -l --include "*.js" "myText" | wdio wdio.conf.js
```

_**نکته:** این پرچم `--spec` برای اجرای یک مشخصات واحد را نادیده نمی‌گیرد._

## اجرای آزمون‌های خاص با MochaOpts

همچنین می‌توانید با ارسال آرگومان خاص mocha: `--mochaOpts.grep` به CLI wdio، فیلتر کنید که کدام `suite|describe` و/یا `it|test` خاص را می‌خواهید اجرا کنید.

```sh
wdio wdio.conf.js --mochaOpts.grep myText
wdio wdio.conf.js --mochaOpts.grep "Text with spaces"
```

_**نکته:** Mocha آزمون‌ها را پس از ایجاد نمونه‌ها توسط اجراکننده آزمون WDIO فیلتر می‌کند، بنابراین ممکن است چندین نمونه را ببینید که راه‌اندازی می‌شوند اما عملاً اجرا نمی‌شوند._

## استثنا کردن آزمون‌های خاص با MochaOpts

همچنین می‌توانید با ارسال آرگومان خاص mocha: `--mochaOpts.invert` به CLI wdio، فیلتر کنید که کدام `suite|describe` و/یا `it|test` خاص را می‌خواهید حذف کنید. `--mochaOpts.invert` عکس عملکرد `--mochaOpts.grep` را انجام می‌دهد

```sh
wdio wdio.conf.js --mochaOpts.grep "string|regex" --mochaOpts.invert
wdio wdio.conf.js --spec ./test/specs/e2e/login.js --mochaOpts.grep "string|regex" --mochaOpts.invert
```

_**نکته:** Mocha آزمون‌ها را پس از ایجاد نمونه‌ها توسط اجراکننده آزمون WDIO فیلتر می‌کند، بنابراین ممکن است چندین نمونه را ببینید که راه‌اندازی می‌شوند اما عملاً اجرا نمی‌شوند._

## توقف آزمایش پس از شکست

با گزینه `bail`، می‌توانید به WebdriverIO بگویید پس از شکست هر آزمون، آزمایش را متوقف کند.

این در مجموعه‌های آزمون بزرگ مفید است، وقتی که از قبل می‌دانید بیلد شما شکست خواهد خورد، اما می‌خواهید از انتظار طولانی یک اجرای آزمون کامل جلوگیری کنید.

گزینه `bail` یک عدد را انتظار دارد، که مشخص می‌کند قبل از اینکه WebDriver کل اجرای آزمون را متوقف کند، چند شکست آزمون می‌تواند رخ دهد. پیش‌فرض `0` است، به این معنی که همیشه تمام مشخصات آزمونی را که می‌تواند پیدا کند اجرا می‌کند.

برای اطلاعات بیشتر در مورد پیکربندی bail، لطفاً به [صفحه گزینه‌ها](configuration) مراجعه کنید.

## سلسله مراتب گزینه‌های اجرا

هنگام تعیین اینکه کدام مشخصات را اجرا کنید، سلسله مراتب خاصی وجود دارد که مشخص می‌کند کدام الگو اولویت خواهد داشت. در حال حاضر، این روند کار از بالاترین اولویت به پایین‌ترین اولویت به شرح زیر است:

> آرگومان CLI `--spec` > الگوی قابلیت `specs` > الگوی پیکربندی `specs`
> آرگومان CLI `--exclude` > الگوی پیکربندی `exclude` > الگوی قابلیت `exclude`

اگر فقط پارامتر پیکربندی داده شود، برای همه قابلیت‌ها استفاده می‌شود. با این حال، اگر الگو را در سطح قابلیت تعریف کنید، به جای الگوی پیکربندی استفاده می‌شود. در نهایت، هر الگوی مشخصات تعریف شده در خط فرمان، تمام الگوهای دیگر را نادیده می‌گیرد.

### استفاده از الگوهای مشخصات تعریف شده در قابلیت

وقتی یک الگوی مشخصات را در سطح قابلیت تعریف می‌کنید، الگوهای تعریف شده در سطح پیکربندی را نادیده می‌گیرد. این زمانی مفید است که نیاز به جداسازی آزمون‌ها بر اساس قابلیت‌های متمایز دستگاه داشته باشید. در چنین مواردی، استفاده از یک الگوی مشخصات عمومی در سطح پیکربندی و الگوهای خاص‌تر در سطح قابلیت، مفیدتر است.

به عنوان مثال، فرض کنید دو دایرکتوری داشتید، یکی برای آزمون‌های Android و دیگری برای آزمون‌های iOS.

فایل پیکربندی شما ممکن است الگو را به صورت زیر برای آزمون‌های دستگاه غیر خاص تعریف کند:

```js
{
    specs: ['tests/general/**/*.js']
}
```

اما سپس، شما قابلیت‌های مختلفی برای دستگاه‌های Android و iOS خود خواهید داشت، که در آن الگوها می‌توانند مانند موارد زیر باشند:

```json
{
  "platformName": "Android",
  "specs": [
    "tests/android/**/*.js"
  ]
}
```

```json
{
  "platformName": "iOS",
  "specs": [
    "tests/ios/**/*.js"
  ]
}
```

اگر به هر دوی این قابلیت‌ها در فایل پیکربندی خود نیاز دارید، سپس دستگاه Android فقط آزمون‌های تحت فضای نام "android" را اجرا می‌کند و آزمون‌های iOS فقط آزمون‌های تحت فضای نام "ios" را اجرا می‌کنند!

```js
//wdio.conf.js
export const config = {
    "specs": [
        "tests/general/**/*.js"
    ],
    "capabilities": [
        {
            platformName: "Android",
            specs: ["tests/android/**/*.js"],
            //...
        },
        {
            platformName: "iOS",
            specs: ["tests/ios/**/*.js"],
            //...
        },
        {
            platformName: "Chrome",
            //config level specs will be used
        }
    ]
}
```