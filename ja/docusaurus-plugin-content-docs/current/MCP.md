---
id: mcp
title: MCP（モデルコンテキストプロトコル）
---

## できること

WebdriverIO MCPは、**モデルコンテキストプロトコル（MCP）サーバー**であり、Claude DesktopやClaude Codeなどのアシスタントがウェブブラウザやモバイルアプリケーションを自動化して操作できるようにします。

### なぜWebdriverIO MCPなのか？

-   **モバイルファースト**: ブラウザのみのMCPサーバーとは異なり、WebdriverIO MCPはAppiumを介してiOSとAndroidのネイティブアプリの自動化をサポートしています
-   **クロスプラットフォームセレクタ**: スマートな要素検出により、複数のロケーター戦略（アクセシビリティID、XPath、UiAutomator、iOS predicates）が自動的に生成されます
-   **WebdriverIOエコシステム**: 豊富なサービスとレポーターのエコシステムを持つ実績のあるWebdriverIOフレームワーク上に構築されています

以下を統一したインターフェースで提供します：

-   🖥️ **デスクトップブラウザ**（Chrome - ヘッドモードまたはヘッドレスモード）
-   📱 **ネイティブモバイルアプリ**（iOSシミュレータ / Androidエミュレータ / Appiumを介した実機）
-   📳 **ハイブリッドモバイルアプリ**（Appiumを介したネイティブ + WebViewコンテキスト切り替え）

これらは[`@wdio/mcp`](https://www.npmjs.com/package/@wdio/mcp)パッケージを通じて提供されます。

これによりAIアシスタントは以下のことができます：

-   **ブラウザの起動と制御** - 設定可能な寸法、ヘッドレスモード、オプションの初期ナビゲーション
-   **ウェブサイトのナビゲーション** - 要素との対話（クリック、入力、スクロール）
-   **ページコンテンツの分析** - アクセシビリティツリーと可視要素の検出（ページネーションサポート付き）
-   **スクリーンショットの撮影** - 自動最適化（サイズ変更、最大1MBに圧縮）
-   **Cookieの管理** - セッション処理用
-   **モバイルデバイスの制御** - ジェスチャー（タップ、スワイプ、ドラッグアンドドロップ）を含む
-   **コンテキストの切り替え** - ハイブリッドアプリでのネイティブとWebView間の切り替え
-   **スクリプトの実行** - ブラウザでのJavaScript、デバイス上のAppiumモバイルコマンド
-   **デバイス機能の処理** - 回転、キーボード、位置情報など
-   さらに多くの機能については、[ツール](./mcp/tools)と[設定](./mcp/configuration)のオプションを参照してください

:::info

モバイルアプリの注意事項
モバイル自動化には、適切なドライバーがインストールされた実行中のAppiumサーバーが必要です。セットアップ手順については[前提条件](#prerequisites)を参照してください。

:::

## インストール

`@wdio/mcp`を使用する最も簡単な方法は、ローカルインストールなしでnpxを使用することです：

```sh
npx @wdio/mcp
```

またはグローバルにインストールします：

```sh
npm install -g @wdio/mcp
```

## Claudeでの使用

WebdriverIO MCPをClaudeで使用するには、構成ファイルを変更します：

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"]
        }
    }
}
```

設定を追加した後、Claudeを再起動してください。WebdriverIO MCPツールがブラウザとモバイル自動化タスク用に利用可能になります。

### Claude Codeでの使用

Claude CodeはMCPサーバーを自動的に検出します。プロジェクトの`.claude/settings.json`または`.mcp.json`で設定できます。

または以下を実行して.claude.jsonにグローバルに追加できます：
```bash
claude mcp add --transport stdio wdio-mcp -- npx -y @wdio/mcp
```
Claude Code内で`/mcp`コマンドを実行して検証します。

## クイックスタート例

### ブラウザ自動化

Claudeにブラウザタスクを自動化するよう依頼します：

```
"Chromeを開いてhttps://webdriver.ioに移動する"
"「Get Started」ボタンをクリックする"
"ページのスクリーンショットを撮る"
"ページ上の全ての表示されているリンクを見つける"
```

### モバイルアプリ自動化

Claudeにモバイルアプリを自動化するよう依頼します：

```
"iPhone 15シミュレータで私のiOSアプリを起動する"
"ログインボタンをタップする"
"上にスワイプして下にスクロールする"
"現在の画面のスクリーンショットを撮る"
```

## 機能

### ブラウザ自動化（Chrome）

| 機能 | 説明 |
|---------|-------------|
| **セッション管理** | ヘッド/ヘッドレスモードでのChromeの起動（カスタムサイズとオプションのナビゲーションURL付き） |
| **ナビゲーション** | URLへのナビゲーション |
| **要素の操作** | 要素のクリック、テキスト入力、様々なセレクタによる要素の検索 |
| **ページ分析** | 可視要素（ページネーション付き）、アクセシビリティツリー（フィルタリング付き）の取得 |
| **スクリーンショット** | スクリーンショットの撮影（最大1MBに自動最適化） |
| **スクロール** | 設定可能なピクセル量での上下スクロール |
| **Cookie管理** | Cookieの取得、設定、削除 |
| **スクリプト実行** | ブラウザコンテキストでのカスタムJavaScriptの実行 |

### モバイルアプリ自動化（iOS/Android）

| 機能 | 説明 |
|---------|-------------|
| **セッション管理** | シミュレータ、エミュレータ、実機でのアプリ起動 |
| **タッチジェスチャー** | タップ、スワイプ、ドラッグアンドドロップ |
| **要素検出** | 複数のロケーター戦略とページネーションを備えたスマート要素検出 |
| **アプリライフサイクル** | アプリの状態の取得（アクティベート/終了のための`execute_script`経由） |
| **コンテキスト切り替え** | ハイブリッドアプリでのネイティブとWebViewコンテキスト間の切り替え |
| **デバイス制御** | デバイスの回転、キーボード制御 |
| **位置情報** | デバイスのGPS座標の取得と設定 |
| **権限** | 自動的な権限とアラート処理 |
| **スクリプト実行** | Appiumモバイルコマンド（pressKey、deepLink、shell等）の実行 |

## 前提条件

### ブラウザ自動化

-   **Chrome**がシステムにインストールされている必要があります
-   WebdriverIOは自動ChromeDriver管理を処理します

### モバイル自動化

#### iOS

1. **Xcodeをインストール**（Mac App Storeから）
2. **Xcodeコマンドラインツールをインストール**：
   ```sh
   xcode-select --install
   ```
3. **Appiumをインストール**：
   ```sh
   npm install -g appium
   ```
4. **XCUITestドライバーをインストール**：
   ```sh
   appium driver install xcuitest
   ```
5. **Appiumサーバーを起動**：
   ```sh
   appium
   ```
6. **シミュレータの場合**：Xcode → ウィンドウ → デバイスとシミュレータでシミュレータを作成/管理
7. **実機の場合**：デバイスのUDID（40文字の一意の識別子）が必要です

#### Android

1. **Android Studioをインストール**してAndroid SDKをセットアップ
2. **環境変数を設定**：
   ```sh
   export ANDROID_HOME=$HOME/Library/Android/sdk
   export PATH=$PATH:$ANDROID_HOME/emulator
   export PATH=$PATH:$ANDROID_HOME/platform-tools
   ```
3. **Appiumをインストール**：
   ```sh
   npm install -g appium
   ```
4. **UiAutomator2ドライバーをインストール**：
   ```sh
   appium driver install uiautomator2
   ```
5. **Appiumサーバーを起動**：
   ```sh
   appium
   ```
6. **エミュレータを作成** - Android Studio → Virtual Device Managerから
7. **テスト実行前にエミュレータを起動**

## アーキテクチャ

### 仕組み

WebdriverIO MCPはAIアシスタントとブラウザ/モバイル自動化の間のブリッジとして機能します：

```
┌─────────────────┐     MCPプロトコル      ┌─────────────────┐
│  Claude Desktop │ ◄──────────────────►  │    @wdio/mcp    │
│  または Claude Code │     (stdio)         │     サーバー     │
└─────────────────┘                       └────────┬────────┘
                                                   │
                                             WebDriverIO API
                                                   │
                    ┌──────────────────────────────┼──────────────────────────────┐
                    │                              │                              │
            ┌───────▼───────┐             ┌───────▼───────┐             ┌───────▼───────┐
            │    Chrome     │             │    Appium     │             │    Appium     │
            │   (ブラウザ)   │             │     (iOS)     │             │   (Android)   │
            └───────────────┘             └───────────────┘             └───────────────┘
```

### セッション管理

-   **シングルセッションモデル**：一度に1つのブラウザまたはアプリセッションのみがアクティブになります
-   **セッション状態**はツール呼び出し全体でグローバルに維持されます
-   **自動デタッチ**：保存された状態（`noReset: true`）を持つセッションは閉じる際に自動的にデタッチされます

### 要素検出

#### ブラウザ（Web）

-   可視でインタラクト可能な全ての要素を見つけるための最適化されたブラウザスクリプトを使用
-   CSSセレクタ、ID、クラス、ARIA情報を含む要素を返します
-   デフォルトでビューポート内の可視要素にフィルタリングします

#### モバイル（ネイティブアプリ）

-   効率的なXMLページソース解析を使用（従来のクエリの600+に対して2つのHTTPコール）
-   AndroidとiOS向けのプラットフォーム固有の要素分類
-   要素ごとに複数のロケーター戦略を生成：
    -   アクセシビリティID（クロスプラットフォーム、最も安定）
    -   リソースID / 名前属性
    -   テキスト / ラベル一致
    -   XPath（完全および簡略化）
    -   UiAutomator（Android）/ Predicates（iOS）

## セレクタ構文

MCPサーバーは複数のセレクタ戦略をサポートしています。詳細なドキュメントについては[セレクタ](./mcp/selectors)を参照してください。

### Web（CSS/XPath）

```
# CSSセレクタ
button.my-class
#element-id
[data-testid="login"]

# XPath
//button[@class='submit']
//a[contains(text(), 'Click')]

# テキストセレクタ（WebdriverIO固有）
button=正確なボタンテキスト
a*=部分的なリンクテキスト
```

### モバイル（クロスプラットフォーム）

```
# アクセシビリティID（推奨 - iOSとAndroidで動作）
~loginButton

# Android UiAutomator
android=new UiSelector().text("Login")

# iOS Predicate String
-ios predicate string:label == "Login"

# iOS Class Chain
-ios class chain:**/XCUIElementTypeButton[`label == "Login"`]

# XPath（両プラットフォームで動作）
//android.widget.Button[@text="Login"]
//XCUIElementTypeButton[@label="Login"]
```

## 利用可能なツール

MCPサーバーはブラウザとモバイルの自動化のための25のツールを提供しています。完全なリファレンスについては[ツール](./mcp/tools)を参照してください。

### ブラウザツール

| ツール | 説明 |
|------|-------------|
| `start_browser` | Chromeブラウザを起動（オプションの初期URL付き） |
| `close_session` | セッションを閉じるまたはデタッチする |
| `navigate` | URLに移動する |
| `click_element` | 要素をクリックする |
| `set_value` | 入力フィールドにテキストを入力する |
| `get_visible_elements` | 可視/インタラクト可能な要素を取得（ページネーション付き） |
| `get_accessibility` | アクセシビリティツリーを取得（フィルタリング付き） |
| `take_screenshot` | スクリーンショットを撮影（自動最適化） |
| `scroll` | ページを上下にスクロールする |
| `get_cookies` / `set_cookie` / `delete_cookies` | Cookie管理 |
| `execute_script` | ブラウザコンテキストでJavaScriptを実行する |

### モバイルツール

| ツール | 説明 |
|------|-------------|
| `start_app_session` | iOS/Androidアプリを起動する |
| `tap_element` | 要素または座標をタップする |
| `swipe` | 方向にスワイプする |
| `drag_and_drop` | 場所間でドラッグする |
| `get_app_state` | アプリが実行中かどうかを確認する |
| `get_contexts` / `switch_context` | ハイブリッドアプリのコンテキスト切り替え |
| `rotate_device` | ポートレート/ランドスケープに回転する |
| `get_geolocation` / `set_geolocation` | GPS座標を取得または設定する |
| `hide_keyboard` | オンスクリーンキーボードを非表示にする |
| `execute_script` | Appiumモバイルコマンドを実行する |

## 自動処理

### 権限

デフォルトでは、MCPサーバーはアプリの権限を自動的に付与し（`autoGrantPermissions: true`）、自動化中に手動で権限ダイアログを処理する必要がなくなります。

### システムアラート

システムアラート（「通知を許可しますか？」など）はデフォルトで自動的に受け入れられます（`autoAcceptAlerts: true`）。これは`autoDismissAlerts: true`で拒否するように設定することもできます。

## 設定

### 環境変数

Appiumサーバー接続を設定します：

| 変数 | デフォルト | 説明 |
|----------|---------|-------------|
| `APPIUM_URL` | `127.0.0.1` | Appiumサーバーのホスト名 |
| `APPIUM_URL_PORT` | `4723` | Appiumサーバーのポート |
| `APPIUM_PATH` | `/` | Appiumサーバーのパス |

### カスタムAppiumサーバーの例

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"],
            "env": {
                "APPIUM_URL": "192.168.1.100",
                "APPIUM_URL_PORT": "4724"
            }
        }
    }
}
```

## パフォーマンス最適化

MCPサーバーは効率的なAIアシスタント通信のために最適化されています：

-   **TOONフォーマット**：最小限のトークン使用のためにトークン指向オブジェクト表記法を使用
-   **XML解析**：モバイル要素検出は2つのHTTPコール（従来の600+に対して）を使用
-   **スクリーンショット圧縮**：Sharpを使用して画像を最大1MBに自動圧縮
-   **ビューポートフィルタリング**：デフォルトで可視要素のみを返す
-   **ページネーション**：大きな要素リストはレスポンスサイズを減らすためにページ分割可能

## TypeScriptサポート

MCPサーバーはTypeScriptで書かれており、完全な型定義を含んでいます。サーバーをプログラムで拡張または統合する場合、自動補完と型安全性の恩恵を受けることができます。

## エラー処理

すべてのツールは堅牢なエラー処理で設計されています：

-   エラーはテキストコンテンツとして返され（決して例外をスローしない）、MCPプロトコルの安定性を維持します
-   説明的なエラーメッセージで問題の診断に役立ちます
-   個々の操作が失敗しても、セッション状態は保持されます

## ユースケース

### 品質保証

-   AI駆動のテストケース実行
-   スクリーンショットによる視覚的リグレッションテスト
-   アクセシビリティツリー分析によるアクセシビリティ監査

### Webスクレイピングとデータ抽出

-   複雑なマルチページフローのナビゲーション
-   動的コンテンツからの構造化データの抽出
-   認証とセッション管理の処理

### モバイルアプリテスト

-   クロスプラットフォームテスト自動化（iOS + Android）
-   オンボーディングフロー検証
-   ディープリンクとナビゲーションテスト

### 統合テスト

-   エンドツーエンドのワークフローテスト
-   API + UI統合検証
-   マルチプラットフォームの一貫性チェック

## トラブルシューティング

### ブラウザが起動しない

-   Chromeがインストールされていることを確認
-   デフォルトのデバッグポート（9222）を他のプロセスが使用していないことを確認
-   ディスプレイの問題が発生する場合はヘッドレスモードを試す

### Appium接続が失敗する

-   Appiumサーバーが実行中であることを確認（`appium`）
-   AppiumのURLとポート設定を確認
-   適切なドライバーがインストールされていることを確認（`appium driver list`）

### iOSシミュレータの問題

-   Xcodeがインストールされ最新であることを確認
-   シミュレータが利用可能であることを確認（`xcrun simctl list devices`）
-   実機の場合、UDIDが正しいことを確認

### Androidエミュレータの問題

-   Android SDKが適切に設定されていることを確認
-   エミュレータが実行中であることを確認（`adb devices`）
-   `ANDROID_HOME`環境変数が設定されていることを確認

## リソース

-   [ツールリファレンス](./mcp/tools) - 利用可能なツールの完全なリスト
-   [セレクタガイド](./mcp/selectors) - セレクタ構文のドキュメント
-   [設定](./mcp/configuration) - 設定オプション
-   [FAQ](./mcp/faq) - よくある質問
-   [GitHubリポジトリ](https://github.com/webdriverio/mcp) - ソースコードと課題
-   [NPMパッケージ](https://www.npmjs.com/package/@wdio/mcp) - npmのパッケージ
-   [モデルコンテキストプロトコル](https://modelcontextprotocol.io/) - MCP仕様