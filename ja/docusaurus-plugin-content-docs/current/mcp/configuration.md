---
id: configuration
title: 設定
---

このページではWebdriverIO MCPサーバーのすべての設定オプションについて説明します。

## MCPサーバー設定

MCPサーバーはClaude DesktopまたはClaude Codeの設定ファイルを通じて設定されます。

### 基本設定

#### macOS

`~/Library/Application Support/Claude/claude_desktop_config.json`を編集します：

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"]
        }
    }
}
```

#### Windows

`%APPDATA%\Claude\claude_desktop_config.json`を編集します：

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"]
        }
    }
}
```

#### Claude Code

プロジェクトの`.claude/settings.json`を編集します：

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"]
        }
    }
}
```

---

## 環境変数

環境変数を通じてAppiumサーバー接続やその他の設定を構成します。

### Appium接続

| 変数 | タイプ | デフォルト | 説明 |
|----------|------|---------|-------------|
| `APPIUM_URL` | string | `127.0.0.1` | Appiumサーバーのホスト名 |
| `APPIUM_URL_PORT` | number | `4723` | Appiumサーバーのポート |
| `APPIUM_PATH` | string | `/` | Appiumサーバーのパス |

### 環境変数を使用した例

```json
{
    "mcpServers": {
        "wdio-mcp": {
            "command": "npx",
            "args": ["-y", "@wdio/mcp"],
            "env": {
                "APPIUM_URL": "192.168.1.100",
                "APPIUM_URL_PORT": "4724",
                "APPIUM_PATH": "/wd/hub"
            }
        }
    }
}
```

---

## ブラウザセッションオプション

`start_browser`ツールでブラウザセッションを開始する際に利用可能なオプション。

### `headless`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `false`

Chromeをヘッドレスモードで実行します（ブラウザウィンドウが表示されません）。CI/CD環境やブラウザを表示する必要がない場合に便利です。

### `windowWidth`

-   **タイプ:** `number`
-   **必須:** いいえ
-   **デフォルト:** `1920`
-   **範囲:** `400` - `3840`

ブラウザウィンドウの初期幅（ピクセル単位）。

### `windowHeight`

-   **タイプ:** `number`
-   **必須:** いいえ
-   **デフォルト:** `1080`
-   **範囲:** `400` - `2160`

ブラウザウィンドウの初期高さ（ピクセル単位）。

### `navigationUrl`

-   **タイプ:** `string`
-   **必須:** いいえ

ブラウザを起動した直後に移動するURL。`start_browser`に続けて`navigate`を別々に呼び出すよりも効率的です。

**例:** ブラウザを起動して一度にナビゲートする：
```
Start Chrome and navigate to https://webdriver.io
```

---

## モバイルセッションオプション

`start_app_session`ツールでモバイルアプリセッションを開始する際に利用可能なオプション。

### プラットフォームオプション

#### `platform`

-   **タイプ:** `string`
-   **必須:** はい
-   **値:** `iOS` | `Android`

自動化するモバイルプラットフォーム。

#### `platformVersion`

-   **タイプ:** `string`
-   **必須:** いいえ

デバイス/シミュレータ/エミュレータのOSバージョン（例：iOSの場合は`17.0`、Androidの場合は`14`）。

#### `automationName`

-   **タイプ:** `string`
-   **必須:** いいえ
-   **値:** `XCUITest`（iOS）、`UiAutomator2` | `Espresso`（Android）

使用する自動化ドライバー。iOSの場合はデフォルトで`XCUITest`、Androidの場合は`UiAutomator2`。

### デバイスオプション

#### `deviceName`

-   **タイプ:** `string`
-   **必須:** はい

使用するデバイス、シミュレータ、またはエミュレータの名前。

**例:**
-   iOS シミュレータ: `iPhone 15 Pro`, `iPad Air (5th generation)`
-   Android エミュレータ: `Pixel 7`, `Nexus 5X`
-   実機: システムに表示されているデバイス名

#### `udid`

-   **タイプ:** `string`
-   **必須:** いいえ（実機iOSデバイスでは必須）

固有デバイス識別子。実機iOSデバイス（40文字の識別子）では必須で、Android実機では推奨されます。

**UDIDの確認方法:**
-   **iOS:** デバイスを接続し、Finder/iTunesを開き、デバイスをクリック → シリアル番号（クリックしてUDIDを表示）
-   **Android:** ターミナルで`adb devices`を実行

### アプリオプション

#### `appPath`

-   **タイプ:** `string`
-   **必須:** いいえ*

インストールして起動するアプリケーションファイルへのパス。

**サポートされているフォーマット:**
-   iOSシミュレータ: `.app`ディレクトリ
-   iOS実機: `.ipa`ファイル
-   Android: `.apk`ファイル

*`appPath`の提供か、既に実行中のアプリに接続するための`noReset: true`のいずれかが必要です。

#### `appWaitActivity`

-   **タイプ:** `string`
-   **必須:** いいえ（Androidのみ）

アプリ起動時に待機するアクティビティ。指定しない場合、アプリのメイン/ランチャーアクティビティが使用されます。

**例:** `com.example.app.MainActivity`

### セッション状態オプション

#### `noReset`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `false`

セッション間でアプリの状態を保持します。`true`の場合:
-   アプリデータが保持されます（ログイン状態、設定など）
-   セッションは**切り離し**され、終了しません（アプリは実行し続けます）
-   複数のセッションにまたがるユーザージャーニーのテストに便利です
-   既に実行中のアプリに接続するために、`appPath`なしで使用できます

#### `fullReset`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `true`

セッション前にアプリを完全にリセットします。`true`の場合:
-   iOS: アプリをアンインストールして再インストールします
-   Android: アプリデータとキャッシュをクリアします
-   クリーンな状態からの開始に便利です

アプリの状態を完全に保持するには、`fullReset: false`と`noReset: true`を設定します。

### セッションタイムアウト

#### `newCommandTimeout`

-   **タイプ:** `number`
-   **必須:** いいえ
-   **デフォルト:** `60`

Appiumが新しいコマンドを待機する時間（秒）。この時間が経過するとクライアントが終了したと判断し、セッションを終了します。より長いデバッグセッションの場合は、この値を増やします。

**例:**
-   `60` - デフォルト、ほとんどの自動化に適しています
-   `300` - 5分、デバッグや遅い操作のため
-   `600` - 10分、非常に長時間実行されるテストのため

### 自動処理オプション

#### `autoGrantPermissions`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `true`

インストール/起動時にアプリの権限を自動的に許可します。`true`の場合:
-   カメラ、マイク、位置情報などの権限が自動的に許可されます
-   手動での権限ダイアログ処理が不要になります
-   権限ポップアップを回避して自動化を効率化します

:::note Androidのみ
このオプションは主にAndroidに影響します。iOSの権限はシステムの制限により異なる方法で処理する必要があります。
:::

#### `autoAcceptAlerts`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `true`

自動化中に表示されるシステムアラート（ダイアログ）を自動的に受け入れます。

**自動受け入れされるアラートの例:**
-   「通知を許可しますか？」
-   「アプリが位置情報へのアクセスを求めています」
-   「アプリが写真へのアクセスを許可しますか？」

#### `autoDismissAlerts`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `false`

システムアラートを受け入れる代わりに却下（キャンセル）します。`true`に設定されている場合、`autoAcceptAlerts`よりも優先されます。

### Appiumサーバーのオーバーライド

セッションごとにAppiumサーバー接続を上書きできます：

#### `appiumHost`

-   **タイプ:** `string`
-   **必須:** いいえ

Appiumサーバーのホスト名。`APPIUM_URL`環境変数を上書きします。

#### `appiumPort`

-   **タイプ:** `number`
-   **必須:** いいえ

Appiumサーバーのポート。`APPIUM_URL_PORT`環境変数を上書きします。

#### `appiumPath`

-   **タイプ:** `string`
-   **必須:** いいえ

Appiumサーバーのパス。`APPIUM_PATH`環境変数を上書きします。

---

## 要素検出オプション

`get_visible_elements`ツールのオプション。

### `elementType`

-   **タイプ:** `string`
-   **必須:** いいえ
-   **デフォルト:** `interactable`
-   **値:** `interactable` | `visual` | `all`

返す要素のタイプ:
-   `interactable`: ボタン、リンク、入力フィールドなどのクリック可能な要素
-   `visual`: 画像、SVGなどの視覚的要素
-   `all`: インタラクティブな要素と視覚的要素の両方

### `inViewportOnly`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `true`

現在のビューポート内に表示されている要素のみを返します。`false`の場合、ビュー階層内のすべての要素を返します（画面外の要素を見つけるのに便利）。

### `includeContainers`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `false`

結果にコンテナ/レイアウト要素を含めます。`true`の場合：

**含まれるAndroidコンテナ:**
-   `ViewGroup`, `FrameLayout`, `LinearLayout`
-   `RelativeLayout`, `ConstraintLayout`
-   `ScrollView`, `RecyclerView`

**含まれるiOSコンテナ:**
-   `View`, `StackView`, `CollectionView`
-   `ScrollView`, `TableView`

レイアウトの問題のデバッグやビュー階層の理解に役立ちます。

### `includeBounds`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `false`

レスポンスに要素の境界/座標（x、y、幅、高さ）を含めます。以下の場合に`true`に設定します：
-   座標ベースのインタラクション
-   レイアウトのデバッグ
-   視覚的要素の位置決め

### ページネーションオプション

多くの要素を持つ大きなページでは、トークン使用量を減らすためにページネーションを使用します：

#### `limit`

-   **タイプ:** `number`
-   **必須:** いいえ
-   **デフォルト:** `0`（無制限）

返す要素の最大数。

#### `offset`

-   **タイプ:** `number`
-   **必須:** いいえ
-   **デフォルト:** `0`

結果を返す前にスキップする要素の数。

**例:** 21-40の要素を取得する：
```
Get visible elements with limit 20 and offset 20
```

---

## アクセシビリティツリーオプション

`get_accessibility`ツール（ブラウザのみ）のオプション。

### `limit`

-   **タイプ:** `number`
-   **必須:** いいえ
-   **デフォルト:** `100`

返すノードの最大数。無制限の場合は`0`を使用します（大きなページには推奨されません）。

### `offset`

-   **タイプ:** `number`
-   **必須:** いいえ
-   **デフォルト:** `0`

ページネーション用にスキップするノードの数。

### `roles`

-   **タイプ:** `string[]`
-   **必須:** いいえ
-   **デフォルト:** すべてのロール

特定のアクセシビリティロールにフィルタリングします。

**一般的なロール:** `button`, `link`, `textbox`, `checkbox`, `radio`, `heading`, `img`, `listitem`

**例:** ボタンとリンクのみを取得する：
```
Get accessibility tree filtered to button and link roles
```

### `namedOnly`

-   **タイプ:** `boolean`
-   **必須:** いいえ
-   **デフォルト:** `true`

名前/ラベルを持つノードのみを返します。匿名のコンテナをフィルタリングし、結果のノイズを減らします。

---

## スクリーンショットオプション

`take_screenshot`ツールのオプション。

### `outputPath`

-   **タイプ:** `string`
-   **必須:** いいえ

スクリーンショットファイルを保存するパス。指定しない場合、base64エンコードされた画像データを返します。

### 自動最適化

スクリーンショットはLLM消費のために自動的に処理されて最適化されます：

| 最適化 | 値 | 説明 |
|--------------|-------|-------------|
| 最大寸法 | 2000px | 2000pxより大きい画像は縮小されます |
| 最大ファイルサイズ | 1MB | 画像は1MB未満に圧縮されます |
| フォーマット | PNG/JPEG | 最大圧縮のPNG、サイズが必要な場合はJPEG |

この最適化により、トークン制限を超えることなく、スクリーンショットを効率的に処理できます。

---

## セッションの動作

### セッションタイプ

MCPサーバーは、適切なツールと動作を提供するためにセッションタイプを追跡します：

| タイプ | 説明 | 自動切り離し |
|------|-------------|-------------|
| `browser` | Chromeブラウザセッション | いいえ |
| `ios` | iOSアプリセッション | はい（`noReset: true`または`appPath`なしの場合） |
| `android` | Androidアプリセッション | はい（`noReset: true`または`appPath`なしの場合） |

### 単一セッションモデル

MCPサーバーは**単一セッションモデル**で動作します：

-   一度にアクティブにできるのは1つのブラウザまたはアプリセッションのみです
-   新しいセッションを開始すると、現在のセッションが閉じられるか切り離されます
-   セッション状態はツール呼び出し間でグローバルに維持されます

### 切り離しと閉じる

| アクション | `detach: false`（閉じる） | `detach: true`（切り離す） |
|--------|-------------------------|-------------------------|
| ブラウザ | Chromeを完全に閉じます | Chromeを実行したまま、WebDriverとの接続を切断します |
| モバイルアプリ | アプリを終了します | アプリを現在の状態で実行したままにします |
| ユースケース | 次のセッションのためのクリーンな状態 | 状態の保持、手動検査 |

---

## パフォーマンスの考慮事項

MCPサーバーは**TOON（Token-Oriented Object Notation）**フォーマットを使用して、Claudeへのデータ送信時のトークン使用量を最小限に抑えるよう最適化されています。

### ブラウザ自動化

-   **ヘッドレスモード**はより高速ですが、視覚的な要素をレンダリングしません
-   **小さいウィンドウサイズ**はスクリーンショットのキャプチャ時間を削減します
-   **要素検出**は単一のスクリプト実行で最適化されています
-   **スクリーンショット最適化**は効率的な処理のために画像を1MB未満に保ちます
-   **`inViewportOnly: true`**（デフォルト）は表示されている要素のみにフィルタリングします

### モバイル自動化

-   **XMLページソース解析**は従来の要素クエリ（600+回）と比較して2回のHTTP呼び出しのみを使用します
-   **アクセシビリティIDセレクタ**が最速で最も信頼性が高いです
-   **XPathセレクタ**は最も遅いです - 最後の手段としてのみ使用してください
-   **`inViewportOnly: true`**（デフォルト）は要素数を大幅に削減します
-   **ページネーション**（`limit`と`offset`）は多くの要素を持つ画面のトークン使用量を削減します
-   **`includeBounds: false`**（デフォルト）は必要でない限り座標データを省略します

### トークン使用のヒント

| 設定 | 影響 |
|---------|--------|
| `inViewportOnly: true` | 画面外の要素をフィルタリングし、レスポンスサイズを削減します |
| `includeContainers: false` | レイアウト要素（ViewGroupなど）を除外します |
| `includeBounds: false` | x/y/width/heightデータを省略します |
| `limit`とページネーション | すべてを一度に処理する代わりに要素をバッチで処理します |
| `namedOnly: true`（アクセシビリティ） | 匿名ノードをフィルタリングします |

---

## Appiumサーバーセットアップ

モバイル自動化を使用する前に、Appiumが適切に設定されていることを確認してください。

### 基本セットアップ

```sh
# Appiumをグローバルにインストール
npm install -g appium

# ドライバーをインストール
appium driver install xcuitest    # iOS
appium driver install uiautomator2  # Android

# サーバーを起動
appium
```

### カスタムサーバー構成

```sh
# カスタムホストとポートで起動
appium --address 0.0.0.0 --port 4724

# ログ付きで起動
appium --log-level debug

# 特定のベースパスで起動
appium --base-path /wd/hub
```

### インストール確認

```sh
# インストールされたドライバーを確認
appium driver list --installed

# Appiumバージョンを確認
appium --version

# 接続をテスト
curl http://localhost:4723/status
```

---

## 設定のトラブルシューティング

### MCPサーバーが起動しない

1. npm/npxがインストールされていることを確認する: `npm --version`
2. 手動で実行してみる: `npx @wdio/mcp`
3. Claude Desktopのログでエラーを確認する

### Appium接続の問題

1. Appiumが実行中であることを確認する: `curl http://localhost:4723/status`
2. 環境変数がAppiumサーバー設定と一致することを確認する
3. ファイアウォールがAppiumポートへの接続を許可していることを確認する

### セッションが開始しない

1. **ブラウザ:** Chromeがインストールされていることを確認する
2. **iOS:** Xcodeとシミュレータが利用可能であることを確認する
3. **Android:** `ANDROID_HOME`とエミュレータが実行中であることを確認する
4. 詳細なエラーメッセージについてAppiumサーバーログを確認する

### セッションタイムアウト

デバッグ中にセッションがタイムアウトする場合：
1. セッション開始時に`newCommandTimeout`を増やす
2. セッション間で状態を保持するために`noReset: true`を使用する
3. アプリを実行したままにするために閉じるときに`detach: true`を使用する