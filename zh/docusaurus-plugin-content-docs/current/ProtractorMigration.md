---
id: protractor-migration
title: ä» Protractor è¿ç§»
---

æœ¬æ•™ç¨‹é¢å‘æ­£åœ¨ä½¿ç”¨ Protractor å¹¶å¸Œæœ›å°†å…¶æ¡†æ¶è¿ç§»åˆ° WebdriverIO çš„ç”¨æˆ·ã€‚è¿™ä¸€æ•™ç¨‹çš„åˆ›å»ºæºäº Angular å›¢é˜Ÿ[å®£å¸ƒ](https://github.com/angular/protractor/issues/5502) Protractor å°†ä¸å†å—æ”¯æŒã€‚WebdriverIO å—åˆ°äº† Protractor è®¸å¤šè®¾è®¡å†³ç­–çš„å½±å“ï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå®ƒå¯èƒ½æ˜¯æœ€æ¥è¿‘è¿ç§»çš„æ¡†æ¶ã€‚WebdriverIO å›¢é˜Ÿæ„Ÿè°¢æ¯ä¸€ä½ Protractor è´¡çŒ®è€…çš„å·¥ä½œï¼Œå¹¶å¸Œæœ›æœ¬æ•™ç¨‹èƒ½ä½¿å‘ WebdriverIO çš„è¿‡æ¸¡å˜å¾—ç®€å•ç›´æ¥ã€‚

è™½ç„¶æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€ä¸ªå®Œå…¨è‡ªåŠ¨åŒ–çš„è¿ç§»è¿‡ç¨‹ï¼Œä½†ç°å®æƒ…å†µå´ä¸åŒã€‚æ¯ä¸ªäººéƒ½æœ‰ä¸åŒçš„è®¾ç½®ï¼Œå¹¶ä»¥ä¸åŒçš„æ–¹å¼ä½¿ç”¨ Protractorã€‚æ¯ä¸ªæ­¥éª¤éƒ½åº”è¯¥è¢«è§†ä¸ºæŒ‡å¯¼ï¼Œè€Œä¸æ˜¯ä¸€æ­¥ä¸€æ­¥çš„è¯´æ˜ã€‚å¦‚æœæ‚¨åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œè¯·éšæ—¶[è”ç³»æˆ‘ä»¬](https://github.com/webdriverio/codemod/discussions/new)ã€‚

## è®¾ç½®

Protractor å’Œ WebdriverIO çš„ API å®é™…ä¸Šéå¸¸ç›¸ä¼¼ï¼Œä»¥è‡³äºå¤§å¤šæ•°å‘½ä»¤å¯ä»¥é€šè¿‡[ä»£ç é‡æ„å·¥å…·](https://github.com/webdriverio/codemod)è‡ªåŠ¨é‡å†™ã€‚

è¦å®‰è£…ä»£ç é‡æ„å·¥å…·ï¼Œè¯·è¿è¡Œï¼š

```sh
npm install jscodeshift @wdio/codemod
```

## ç­–ç•¥

æœ‰å¾ˆå¤šè¿ç§»ç­–ç•¥ã€‚æ ¹æ®æ‚¨å›¢é˜Ÿçš„è§„æ¨¡ã€æµ‹è¯•æ–‡ä»¶æ•°é‡å’Œè¿ç§»çš„ç´§æ€¥ç¨‹åº¦ï¼Œæ‚¨å¯ä»¥å°è¯•ä¸€æ¬¡æ€§è½¬æ¢æ‰€æœ‰æµ‹è¯•æˆ–é€ä¸ªæ–‡ä»¶è½¬æ¢ã€‚é‰´äº Protractor å°†ç»§ç»­ç»´æŠ¤åˆ° Angular ç‰ˆæœ¬ 15ï¼ˆ2022 å¹´åº•ï¼‰ï¼Œæ‚¨ä»æœ‰è¶³å¤Ÿçš„æ—¶é—´ã€‚æ‚¨å¯ä»¥åŒæ—¶è¿è¡Œ Protractor å’Œ WebdriverIO æµ‹è¯•ï¼Œå¹¶å¼€å§‹ç”¨ WebdriverIO ç¼–å†™æ–°æµ‹è¯•ã€‚æ ¹æ®æ‚¨çš„æ—¶é—´é¢„ç®—ï¼Œæ‚¨å¯ä»¥å…ˆè¿ç§»é‡è¦çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åé€æ­¥å¤„ç†é‚£äº›ç”šè‡³å¯èƒ½åˆ é™¤çš„æµ‹è¯•ã€‚

## é¦–å…ˆæ˜¯é…ç½®æ–‡ä»¶

å®‰è£…äº†ä»£ç é‡æ„å·¥å…·åï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹è½¬æ¢ç¬¬ä¸€ä¸ªæ–‡ä»¶ã€‚é¦–å…ˆæŸ¥çœ‹[WebdriverIO çš„é…ç½®é€‰é¡¹](configuration)ã€‚é…ç½®æ–‡ä»¶å¯èƒ½å˜å¾—éå¸¸å¤æ‚ï¼Œä»…è½¬æ¢å¿…è¦éƒ¨åˆ†å¯èƒ½æ›´æœ‰æ„ä¹‰ï¼Œçœ‹çœ‹ä¸€æ—¦éœ€è¦ç‰¹å®šé€‰é¡¹çš„æµ‹è¯•è¢«è¿ç§»åï¼Œå…¶ä½™éƒ¨åˆ†å¦‚ä½•æ·»åŠ ã€‚

å¯¹äºç¬¬ä¸€æ¬¡è¿ç§»ï¼Œæˆ‘ä»¬ä»…è½¬æ¢é…ç½®æ–‡ä»¶å¹¶è¿è¡Œï¼š

```sh
npx jscodeshift -t ./node_modules/@wdio/codemod/protractor ./conf.ts
```

:::info

 æ‚¨çš„é…ç½®æ–‡ä»¶åç§°å¯èƒ½ä¸åŒï¼Œä½†åŸåˆ™åº”è¯¥ç›¸åŒï¼šé¦–å…ˆè¿ç§»é…ç½®æ–‡ä»¶ã€‚

:::

## å®‰è£… WebdriverIO ä¾èµ–

ä¸‹ä¸€æ­¥æ˜¯é…ç½®ä¸€ä¸ªæœ€å°çš„ WebdriverIO è®¾ç½®ï¼Œéšç€æˆ‘ä»¬ä»ä¸€ä¸ªæ¡†æ¶è¿ç§»åˆ°å¦ä¸€ä¸ªæ¡†æ¶ï¼Œæˆ‘ä»¬å°†å¼€å§‹æ„å»ºå®ƒã€‚é¦–å…ˆé€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£… WebdriverIO CLIï¼š

```sh
npm install --save-dev @wdio/cli
```

æ¥ä¸‹æ¥è¿è¡Œé…ç½®å‘å¯¼ï¼š

```sh
npx wdio config
```

è¿™å°†å¼•å¯¼æ‚¨å›ç­”å‡ ä¸ªé—®é¢˜ã€‚å¯¹äºè¿™ä¸ªè¿ç§»åœºæ™¯ï¼Œæ‚¨ï¼š
- é€‰æ‹©é»˜è®¤é€‰æ‹©
- æˆ‘ä»¬å»ºè®®ä¸è¦è‡ªåŠ¨ç”Ÿæˆç¤ºä¾‹æ–‡ä»¶
- ä¸º WebdriverIO æ–‡ä»¶é€‰æ‹©ä¸åŒçš„æ–‡ä»¶å¤¹
- é€‰æ‹© Mocha è€Œé Jasmine

:::info ä¸ºä»€ä¹ˆé€‰æ‹© Mochaï¼Ÿ
å³ä½¿æ‚¨ä¹‹å‰å¯èƒ½ä½¿ç”¨ Protractor å’Œ Jasmineï¼Œä½† Mocha æä¾›äº†æ›´å¥½çš„é‡è¯•æœºåˆ¶ã€‚é€‰æ‹©æƒåœ¨æ‚¨æ‰‹ä¸­ï¼
:::

åœ¨å®Œæˆç®€çŸ­çš„é—®å·è°ƒæŸ¥åï¼Œå‘å¯¼å°†å®‰è£…æ‰€æœ‰å¿…è¦çš„åŒ…å¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨æ‚¨çš„ `package.json` ä¸­ã€‚

## è¿ç§»é…ç½®æ–‡ä»¶

åœ¨æˆ‘ä»¬è½¬æ¢äº† `conf.ts` å¹¶åˆ›å»ºäº†æ–°çš„ `wdio.conf.ts` ä¹‹åï¼Œç°åœ¨æ˜¯æ—¶å€™å°†é…ç½®ä»ä¸€ä¸ªé…ç½®è¿ç§»åˆ°å¦ä¸€ä¸ªé…ç½®äº†ã€‚ç¡®ä¿åªç§»æ¤å¯¹æ‰€æœ‰æµ‹è¯•è¿è¡Œå¿…ä¸å¯å°‘çš„ä»£ç ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ç§»æ¤äº†é’©å­å‡½æ•°å’Œæ¡†æ¶è¶…æ—¶ã€‚

æˆ‘ä»¬ç°åœ¨å°†åªç»§ç»­ä½¿ç”¨ `wdio.conf.ts` æ–‡ä»¶ï¼Œå› æ­¤ä¸å†éœ€è¦å¯¹åŸå§‹ Protractor é…ç½®è¿›è¡Œä»»ä½•æ›´æ”¹ã€‚æˆ‘ä»¬å¯ä»¥æ¢å¤è¿™äº›æ›´æ”¹ï¼Œè¿™æ ·ä¸¤ä¸ªæ¡†æ¶å¯ä»¥å¹¶è¡Œè¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡ç§»æ¤ä¸€ä¸ªæ–‡ä»¶ã€‚

## è¿ç§»æµ‹è¯•æ–‡ä»¶

æˆ‘ä»¬ç°åœ¨å‡†å¤‡ç§»æ¤ç¬¬ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œè®©æˆ‘ä»¬å…ˆä»æ²¡æœ‰å¤ªå¤šç¬¬ä¸‰æ–¹åŒ…ä¾èµ–æˆ–å…¶ä»–æ–‡ä»¶ï¼ˆå¦‚ PageObjectsï¼‰çš„æ–‡ä»¶å¼€å§‹ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œè¦è¿ç§»çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶æ˜¯ `first-test.spec.ts`ã€‚é¦–å…ˆåˆ›å»ºæ–°çš„ WebdriverIO é…ç½®æœŸæœ›çš„ç›®å½•ï¼Œç„¶åç§»åŠ¨æ–‡ä»¶ï¼š

```sh
mv mkdir -p ./test/specs/
mv test-suites/first-test.spec.ts ./test/specs
```

ç°åœ¨è®©æˆ‘ä»¬è½¬æ¢è¿™ä¸ªæ–‡ä»¶ï¼š

```sh
npx jscodeshift -t ./node_modules/@wdio/codemod/protractor ./test/specs/first-test.spec.ts
```

å°±æ˜¯è¿™æ ·ï¼è¿™ä¸ªæ–‡ä»¶éå¸¸ç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ä»»ä½•é¢å¤–çš„æ›´æ”¹ï¼Œå¯ä»¥ç›´æ¥å°è¯•é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿è¡Œ WebdriverIOï¼š

```sh
npx wdio run wdio.conf.ts
```

æ­å–œ ğŸ¥³ æ‚¨åˆšåˆšè¿ç§»äº†ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼

## ä¸‹ä¸€æ­¥

ä»è¿™ä¸€ç‚¹å¼€å§‹ï¼Œæ‚¨ç»§ç»­è½¬æ¢æ¯ä¸ªæµ‹è¯•å’Œé¡µé¢å¯¹è±¡ã€‚ä»£ç é‡æ„å·¥å…·å¯èƒ½ä¼šå¯¹æŸäº›æ–‡ä»¶å¤±è´¥ï¼Œå¹¶æ˜¾ç¤ºå¦‚ä¸‹é”™è¯¯ï¼š

```
ERR /path/to/project/test/testdata/failing_submit.js Transformation error (Error transforming /test/testdata/failing_submit.js:2)
Error transforming /test/testdata/failing_submit.js:2

> login_form.submit()
  ^

The command "submit" is not supported in WebdriverIO. We advise to use the click command to click on the submit button instead. For more information on this configuration, see https://webdriver.io/docs/api/element/click.
  at /path/to/project/test/testdata/failing_submit.js:132:0
```

å¯¹äºæŸäº› Protractor å‘½ä»¤ï¼Œåœ¨ WebdriverIO ä¸­æ²¡æœ‰æ›¿ä»£æ–¹æ¡ˆã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç é‡æ„å·¥å…·ä¼šç»™æ‚¨ä¸€äº›å…³äºå¦‚ä½•é‡æ„çš„å»ºè®®ã€‚å¦‚æœæ‚¨ç»å¸¸é‡åˆ°è¿™æ ·çš„é”™è¯¯æ¶ˆæ¯ï¼Œè¯·éšæ—¶[æå‡ºé—®é¢˜](https://github.com/webdriverio/codemod/issues/new)å¹¶è¦æ±‚æ·»åŠ ç‰¹å®šçš„è½¬æ¢ã€‚è™½ç„¶ä»£ç é‡æ„å·¥å…·å·²ç»è½¬æ¢äº†å¤§éƒ¨åˆ† Protractor APIï¼Œä½†ä»æœ‰å¾ˆå¤§çš„æ”¹è¿›ç©ºé—´ã€‚

## ç»“è®º

æˆ‘ä»¬å¸Œæœ›æœ¬æ•™ç¨‹èƒ½å¤ŸæŒ‡å¯¼æ‚¨å®Œæˆå‘ WebdriverIO çš„è¿ç§»è¿‡ç¨‹ã€‚ç¤¾åŒºç»§ç»­æ”¹è¿›ä»£ç é‡æ„å·¥å…·ï¼ŒåŒæ—¶åœ¨å„ç§ç»„ç»‡å’Œå„ç§å›¢é˜Ÿä¸­æµ‹è¯•å®ƒã€‚å¦‚æœæ‚¨æœ‰åé¦ˆï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œ[æå‡ºé—®é¢˜](https://github.com/webdriverio/codemod/issues/new)ï¼Œæˆ–è€…å¦‚æœæ‚¨åœ¨è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°å›°éš¾ï¼Œè¯·[å¼€å§‹è®¨è®º](https://github.com/webdriverio/codemod/discussions/new)ã€‚